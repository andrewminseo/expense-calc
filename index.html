<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Calculator</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        h1, h2, h3 {
            color: #2c3e50;
        }
        
        .flex-container {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .flex-item {
            flex: 1;
        }
        
        input, select, textarea, button {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        
        .people-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .person-badge {
            background-color: #e8f4fd;
            border: 1px solid #cce5ff;
            border-radius: 4px;
            padding: 5px 10px;
            display: inline-flex;
            align-items: center;
        }
        
        .remove-btn {
            background-color: #ff6b6b;
            color: white;
            width: auto;
            padding: 4px 8px;
            margin-left: 10px;
            margin-bottom: 0;
        }
        
        .checkbox-container {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .checkbox-container input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
            margin-bottom: 0;
        }
        
        .expense-item {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .expense-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .expense-title {
            font-weight: bold;
            font-size: 18px;
            margin: 0;
        }
        
        .expense-amount {
            font-weight: bold;
            color: #2ecc71;
        }
        
        .expense-desc {
            margin-bottom: 10px;
            color: #7f8c8d;
        }
        
        .expense-shares {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .expense-share {
            background-color: #f0f0f0;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .edit-btn {
            background-color: #f39c12;
        }
        
        .delete-btn {
            background-color: #e74c3c;
        }
        
        /* Summary section */
        .summary-box {
            background-color: #eafaf1;
            border-left: 4px solid #2ecc71;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .summary-title {
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .balance-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #ddd;
        }
        
        .balance-positive {
            color: #2ecc71;
        }
        
        .balance-negative {
            color: #e74c3c;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
        }
        
        .tab.active {
            background-color: white;
            border-color: #ddd;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @media (max-width: 768px) {
            .flex-container {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <h1>Expense Calculator</h1>
    
    <div class="tabs">
        <div class="tab active" data-tab="expenses">Expenses</div>
        <div class="tab" data-tab="people">People</div>
        <div class="tab" data-tab="summary">Summary</div>
    </div>
    
    <!-- People Tab -->
    <div id="people-tab" class="tab-content">
        <div class="container">
            <h2>Add People</h2>
            <div class="flex-container">
                <div class="flex-item">
                    <input type="text" id="person-name" placeholder="Enter name">
                    <button id="add-person-btn">Add Person</button>
                </div>
            </div>
            
            <h3>People List</h3>
            <div id="people-list" class="people-container">
                <!-- People will be added here dynamically -->
            </div>
        </div>
    </div>
    
    <!-- Expenses Tab -->
    <div id="expenses-tab" class="tab-content active">
        <div class="container">
            <h2>Add Expense</h2>
            <input type="text" id="expense-title" placeholder="Expense Title (e.g., Dinner, Movie)">
            <textarea id="expense-description" placeholder="Description (optional)" rows="2"></textarea>
            <input type="number" id="expense-amount" placeholder="Amount ($)" min="0" step="0.01">
            
            <h3>Paid by</h3>
            <select id="payer-select">
                <option value="">Select who paid</option>
                <!-- Options will be added dynamically -->
            </select>
            
            <h3>Split between</h3>
            <div id="expense-people-list">
                <!-- Checkboxes will be added dynamically -->
            </div>
            
            <div class="checkbox-container">
                <input type="checkbox" id="split-equally" checked>
                <label for="split-equally">Split equally</label>
            </div>
            
            <div id="custom-split-container" style="display: none;">
                <!-- Custom split inputs will be added here -->
            </div>
            
            <button id="add-expense-btn">Add Expense</button>
        </div>
        
        <div class="container">
            <h2>Expense List</h2>
            <div id="expense-list">
                <!-- Expenses will be added here dynamically -->
            </div>
        </div>
    </div>
    
    <!-- Summary Tab -->
    <div id="summary-tab" class="tab-content">
        <div class="container">
            <h2>Balance Summary</h2>
            <div class="summary-box">
                <div class="summary-title">Who owes who</div>
                <div id="balances-list">
                    <!-- Balances will be added here dynamically -->
                </div>
            </div>
            
            <div>
                <h3>Total Expenses: $<span id="total-expenses">0.00</span></h3>
            </div>
        </div>
    </div>
    
    <script>
        // Data storage
        let people = JSON.parse(localStorage.getItem('people')) || [];
        let expenses = JSON.parse(localStorage.getItem('expenses')) || [];
        
        // DOM Elements
        const personNameInput = document.getElementById('person-name');
        const addPersonBtn = document.getElementById('add-person-btn');
        const peopleList = document.getElementById('people-list');
        const expenseTitleInput = document.getElementById('expense-title');
        const expenseDescInput = document.getElementById('expense-description');
        const expenseAmountInput = document.getElementById('expense-amount');
        const payerSelect = document.getElementById('payer-select');
        const expensePeopleList = document.getElementById('expense-people-list');
        const splitEquallyCheckbox = document.getElementById('split-equally');
        const customSplitContainer = document.getElementById('custom-split-container');
        const addExpenseBtn = document.getElementById('add-expense-btn');
        const expenseList = document.getElementById('expense-list');
        const balancesList = document.getElementById('balances-list');
        const totalExpensesSpan = document.getElementById('total-expenses');
        
        // Tab functionality
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                // Remove active class from all tabs and contents
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));
                
                // Add active class to clicked tab and corresponding content
                tab.classList.add('active');
                document.getElementById(`${tabId}-tab`).classList.add('active');
            });
        });
        
        // Initialize the app
        function init() {
            renderPeopleList();
            renderPayerSelect();
            renderExpensePeopleList();
            renderExpenseList();
            updateBalances();
        }
        
        // Add a person
        addPersonBtn.addEventListener('click', () => {
            const name = personNameInput.value.trim();
            if (name) {
                const person = {
                    id: Date.now().toString(),
                    name: name
                };
                people.push(person);
                savePeople();
                renderPeopleList();
                renderPayerSelect();
                renderExpensePeopleList();
                personNameInput.value = '';
            }
        });
        
        // Render people list
        function renderPeopleList() {
            peopleList.innerHTML = '';
            people.forEach(person => {
                const personElement = document.createElement('div');
                personElement.className = 'person-badge';
                personElement.innerHTML = `
                    ${person.name}
                    <button class="remove-btn" data-id="${person.id}">×</button>
                `;
                peopleList.appendChild(personElement);
            });
            
            // Add event listeners to remove buttons
            const removeButtons = peopleList.querySelectorAll('.remove-btn');
            removeButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    const personId = e.target.getAttribute('data-id');
                    removePerson(personId);
                });
            });
        }
        
        // Remove a person
        function removePerson(personId) {
            // Check if person is involved in any expenses
            const isInvolved = expenses.some(expense => {
                return expense.payer === personId || expense.shares.some(share => share.personId === personId);
            });
            
            if (isInvolved) {
                alert('This person is involved in one or more expenses. Please remove those expenses first.');
                return;
            }
            
            people = people.filter(person => person.id !== personId);
            savePeople();
            renderPeopleList();
            renderPayerSelect();
            renderExpensePeopleList();
        }
        
        // Render payer select dropdown
        function renderPayerSelect() {
            payerSelect.innerHTML = '<option value="">Select who paid</option>';
            people.forEach(person => {
                const option = document.createElement('option');
                option.value = person.id;
                option.textContent = person.name;
                payerSelect.appendChild(option);
            });
        }
        
        // Render expense people list with checkboxes
        function renderExpensePeopleList() {
            expensePeopleList.innerHTML = '';
            people.forEach(person => {
                const div = document.createElement('div');
                div.className = 'checkbox-container';
                div.innerHTML = `
                    <input type="checkbox" id="person-${person.id}" class="person-checkbox" data-id="${person.id}">
                    <label for="person-${person.id}">${person.name}</label>
                    <input type="number" class="custom-share" data-id="${person.id}" style="display: none;" min="0" step="0.01" placeholder="Amount">
                `;
                expensePeopleList.appendChild(div);
            });
            
            // Add event listeners to checkboxes
            const checkboxes = expensePeopleList.querySelectorAll('.person-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', updateCustomSplitVisibility);
            });
        }
        
        // Toggle split equally / custom split
        splitEquallyCheckbox.addEventListener('change', () => {
            customSplitContainer.style.display = splitEquallyCheckbox.checked ? 'none' : 'block';
            
            const customShares = document.querySelectorAll('.custom-share');
            customShares.forEach(input => {
                input.style.display = splitEquallyCheckbox.checked ? 'none' : 'block';
            });
        });
        
        // Update custom split inputs based on selected people
        function updateCustomSplitVisibility() {
            const customShares = document.querySelectorAll('.custom-share');
            customShares.forEach(input => {
                const personId = input.getAttribute('data-id');
                const checkbox = document.querySelector(`.person-checkbox[data-id="${personId}"]`);
                
                if (!splitEquallyCheckbox.checked && checkbox.checked) {
                    input.style.display = 'block';
                } else {
                    input.style.display = 'none';
                }
            });
        }
        
        // Add an expense
        addExpenseBtn.addEventListener('click', () => {
            const title = expenseTitleInput.value.trim();
            const description = expenseDescInput.value.trim();
            const amountStr = expenseAmountInput.value.trim();
            const payer = payerSelect.value;
            
            if (!title || !amountStr || !payer) {
                alert('Please fill in the title, amount, and select who paid.');
                return;
            }
            
            const amount = parseFloat(amountStr);
            if (isNaN(amount) || amount <= 0) {
                alert('Please enter a valid amount.');
                return;
            }
            
            // Get selected people
            const selectedPeople = [];
            const checkboxes = expensePeopleList.querySelectorAll('.person-checkbox:checked');
            checkboxes.forEach(checkbox => {
                selectedPeople.push(checkbox.getAttribute('data-id'));
            });
            
            if (selectedPeople.length === 0) {
                alert('Please select at least one person to split the expense with.');
                return;
            }
            
            // Calculate shares
            let shares = [];
            if (splitEquallyCheckbox.checked) {
                // Split equally
                const shareAmount = amount / selectedPeople.length;
                shares = selectedPeople.map(personId => ({
                    personId,
                    amount: shareAmount
                }));
            } else {
                // Custom split
                shares = selectedPeople.map(personId => {
                    const customShareInput = document.querySelector(`.custom-share[data-id="${personId}"]`);
                    let shareAmount = parseFloat(customShareInput.value);
                    
                    if (isNaN(shareAmount) || shareAmount < 0) {
                        shareAmount = 0;
                    }
                    
                    return {
                        personId,
                        amount: shareAmount
                    };
                });
                
                // Validate total shares
                const totalShares = shares.reduce((sum, share) => sum + share.amount, 0);
                if (Math.abs(totalShares - amount) > 0.01) {
                    alert(`The sum of shares (${totalShares.toFixed(2)}) does not equal the total expense (${amount.toFixed(2)}). Please adjust the amounts.`);
                    return;
                }
            }
            
            // Create expense object
            const expense = {
                id: Date.now().toString(),
                title,
                description,
                amount,
                payer,
                date: new Date().toISOString(),
                shares
            };
            
            expenses.push(expense);
            saveExpenses();
            renderExpenseList();
            updateBalances();
            
            // Clear form
            expenseTitleInput.value = '';
            expenseDescInput.value = '';
            expenseAmountInput.value = '';
            payerSelect.value = '';
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            
            const customShares = document.querySelectorAll('.custom-share');
            customShares.forEach(input => {
                input.value = '';
                input.style.display = 'none';
            });
            
            splitEquallyCheckbox.checked = true;
            customSplitContainer.style.display = 'none';
        });
        
        // Render expense list
        function renderExpenseList() {
            expenseList.innerHTML = '';
            
            if (expenses.length === 0) {
                expenseList.innerHTML = '<p>No expenses added yet.</p>';
                return;
            }
            
            // Sort expenses by date, newest first
            const sortedExpenses = [...expenses].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedExpenses.forEach(expense => {
                const expenseElement = document.createElement('div');
                expenseElement.className = 'expense-item';
                
                // Find payer name
                const payer = people.find(p => p.id === expense.payer);
                const payerName = payer ? payer.name : 'Unknown';
                
                // Format date
                const date = new Date(expense.date);
                const formattedDate = `${date.toLocaleDateString()} ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
                
                // Create shares display
                const sharesHtml = expense.shares.map(share => {
                    const person = people.find(p => p.id === share.personId);
                    const personName = person ? person.name : 'Unknown';
                    return `<div class="expense-share">${personName}: $${share.amount.toFixed(2)}</div>`;
                }).join('');
                
                expenseElement.innerHTML = `
                    <div class="expense-header">
                        <h3 class="expense-title">${expense.title}</h3>
                        <span class="expense-amount">$${expense.amount.toFixed(2)}</span>
                    </div>
                    <div class="expense-desc">${expense.description || 'No description'}</div>
                    <p><strong>Paid by:</strong> ${payerName} on ${formattedDate}</p>
                    <div class="expense-shares">
                        <strong>Shares:</strong>
                        ${sharesHtml}
                    </div>
                    <div class="action-buttons">
                        <button class="delete-btn" data-id="${expense.id}">Delete</button>
                    </div>
                `;
                
                expenseList.appendChild(expenseElement);
            });
            
            // Add event listeners to delete buttons
            const deleteButtons = expenseList.querySelectorAll('.delete-btn');
            deleteButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    const expenseId = e.target.getAttribute('data-id');
                    deleteExpense(expenseId);
                });
            });
        }
        
        // Delete an expense
        function deleteExpense(expenseId) {
            if (confirm('Are you sure you want to delete this expense?')) {
                expenses = expenses.filter(expense => expense.id !== expenseId);
                saveExpenses();
                renderExpenseList();
                updateBalances();
            }
        }
        
        // Calculate and update balances
        function updateBalances() {
            // Initialize net balances for each person
            const balances = {};
            people.forEach(person => {
                balances[person.id] = 0;
            });
            
            // Calculate net amount for each person
            expenses.forEach(expense => {
                // Add the full amount to the payer
                balances[expense.payer] += expense.amount;
                
                // Subtract each person's share
                expense.shares.forEach(share => {
                    balances[share.personId] -= share.amount;
                });
            });
            
            // Calculate who owes whom
            const transactions = calculateOptimalTransactions(balances);
            
            // Display balances
            renderBalances(transactions);
            
            // Update total expenses
            const totalExpenses = expenses.reduce((sum, expense) => sum + expense.amount, 0);
            totalExpensesSpan.textContent = totalExpenses.toFixed(2);
        }
        
        // Calculate optimal transactions to settle debts
        function calculateOptimalTransactions(balances) {
            const transactions = [];
            
            // Create arrays of creditors and debtors
            const creditors = [];
            const debtors = [];
            
            for (const personId in balances) {
                const amount = balances[personId];
                if (Math.abs(amount) < 0.01) continue; // Skip if the balance is effectively zero
                
                if (amount > 0) {
                    creditors.push({ personId, amount });
                } else {
                    debtors.push({ personId, amount: -amount }); // Convert to positive for easier handling
                }
            }
            
            // Sort creditors and debtors by amount (descending)
            creditors.sort((a, b) => b.amount - a.amount);
            debtors.sort((a, b) => b.amount - a.amount);
            
            // Match debtors to creditors
            let i = 0, j = 0;
            while (i < debtors.length && j < creditors.length) {
                const debtor = debtors[i];
                const creditor = creditors[j];
                
                // Calculate transfer amount (minimum of what's owed and what's due)
                const amount = Math.min(debtor.amount, creditor.amount);
                
                if (amount > 0.01) { // Only add transactions with meaningful amounts
                    transactions.push({
                        from: debtor.personId,
                        to: creditor.personId,
                        amount
                    });
                }
                
                // Update remaining amounts
                debtor.amount -= amount;
                creditor.amount -= amount;
                
                // Move to next debtor or creditor if current one is settled
                if (debtor.amount < 0.01) i++;
                if (creditor.amount < 0.01) j++;
            }
            
            return transactions;
        }
        
        // Render balance list
        function renderBalances(transactions) {
            balancesList.innerHTML = '';
            
            if (transactions.length === 0) {
                balancesList.innerHTML = '<p>All settled up! No payments needed.</p>';
                return;
            }
            
            transactions.forEach(transaction => {
                const fromPerson = people.find(p => p.id === transaction.from);
                const toPerson = people.find(p => p.id === transaction.to);
                
                if (fromPerson && toPerson) {
                    const div = document.createElement('div');
                    div.className = 'balance-item';
                    div.innerHTML = `
                        <div>${fromPerson.name} owes ${toPerson.name}</div>
                        <div class="balance-negative">$${transaction.amount.toFixed(2)}</div>
                    `;
                    balancesList.appendChild(div);
                }
            });
        }
        
        // Save people to localStorage
        function savePeople() {
            localStorage.setItem('people', JSON.stringify(people));
        }
        
        // Save expenses to localStorage
        function saveExpenses() {
            localStorage.setItem('expenses', JSON.stringify(expenses));
        }
        
        // Initialize the app
        init();
    </script>
</body>
</html>
